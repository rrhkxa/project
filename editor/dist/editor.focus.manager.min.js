define(function(){function g(c){if("number"==typeof c.selectionStart)b.pos.start=c.selectionStart,b.pos.end=c.selectionEnd;else if(document.selection){var d=document.selection.createRange();if(d.parentElement().className==c.className){var a=document.body.createTextRange();a.moveToElementText(c);for(b.pos.start=0;0>a.compareEndPoints("StartToStart",d);b.pos.start++)a.moveStart("character",1);for(a=0;a<=b.pos.start;a++)"\n"==c.value.charAt(a)&&b.pos.start++;a=document.body.createTextRange();a.moveToElementText(c);
for(b.pos.end=0;0>a.compareEndPoints("StartToEnd",d);b.pos.end++)a.moveStart("character",1);for(a=0;a<=b.pos.end;a++)"\n"==c.value.charAt(a)&&b.pos.end++}}return b.pos}var b={obj:null,pos:{start:0,end:0}};return{save:function(c){b.obj=c;g(c)},insert:function(c,d){var d=d||b.obj,a=d.value,e=a.substr(0,b.pos.start),a=a.substr(b.pos.end);d.value=e+c+a;e=b.pos.start+c.length;a=d;e=e||a.value.length;if(a.createTextRange){var f=a.createTextRange();f.moveStart("character",e);f.collapse(!0);f.select()}else a.setSelectionRange(a.value.length,
e);a.focus()},setObj:function(c){b.obj=c},getPos:g}});
