define(function(require,exports,module){var c=require("jquery"),n=require("artTemplate"),p=require("browTml"),i=require("browJson"),j=require("utils")(),k=require("tools"),f=require("tips"),h=require("pos"),g=window,e=document;g.console||(g.console={},g.console.log=function(){});/debug/.test(location.href);var l=function(b){this.defaults={cache:{},sItem:"[data-s]",ele:"",box:'[data-query="brow"]',tag:'[data-query="tag"]',browBox:'[data-query="browBox"]',browBtn:'[data-query="browBtn"]',cardBox:'[data-query="cardBox"]'};this.options=c.extend(!0,{},this.defaults,
b)};l.prototype={init:function(){this.initStyle();this.bindEvent()},bindEvent:function(){var b=this,a=this.options,d=a.cache;d.currentNode=1111;c(e).on("click",a.sItem,function(a){b.insertEmoticon(this.getAttribute("data-s"));a.preventDefault()});c(e).on("click",a.box,function(){a.cache.m=!0;setTimeout(function(){a.cache.m=!1},100)});c(e).on("click",function(b){"f_p_phiz"===b.target.id||a.cache.m||c(a.box).hide()});c(e).on("focusin focusout mousedown mouseup keyup keydown select","textarea",function(){d.currentNode=
this;h.save(this)});c(e).on("click",a.browBtn,function(b){1>c(a.cardBox).find("li").length?j.showMessage(f.t30):(c(a.box).toggle(),b.preventDefault())});c(e).on("click",a.tag,function(b){var d=c(this).index();c(this).addClass("face_active").siblings().removeClass("face_active");c(a.browBox).eq(d).show().siblings().hide();b.preventDefault()})},insertEmoticon:function(b){var a=this.options.cache.currentNode;if(1111===a)j.showMessage(f.t30),c(this.options.box).hide();else if(a){k.os().mac&&k.browser().safari&&
g.scrollTo(0,a.getBoundingClientRect().top+c(window).scrollTop()-300);if(a.value===f.t7||a.value===f.t10||a.value===f.t6)a.value="";h.insert(b);h.save(a)}},initStyle:function(){var b=this.options;b.ele&&c(b.ele).appendTo("body");b=n.compile(p.tml1)({list1:i.list1,list2:i.list2});c(b).appendTo("body")}};module.exports=function(b){return new l(b)}});
