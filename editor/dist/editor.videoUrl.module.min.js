define(function(require,exports,module){var a=require("jquery"),j=require("tips"),g=require("utils")();g.register({type:"videoUrl",tml:"videoIFrame",getData:function(c){var b=a(c).data("data");return{type:"video",video:b.src,pic:null,text:a(c).find("textarea").val().replace(b.defaultText,""),id:b.id}}});var f=document,h=function(c){this.defaults={cache:{},cardBox:'[data-query="cardBox"]',addVideoCardBtn:'[data-query="addVideoUrlCardBtn"]',box:'[data-query="videoUrlBox"]',mask:'[data-query="mask"]',urlInput:'[data-query="urlInput"]',
addCard:'[data-query="videoCardBtn"]',count:'[data-query="videoCount"]',max:5};this.options=a.extend(!0,{},this.defaults,c)};h.prototype={init:function(){this.bindEvent();a.videoUrlCache=this.options.cache;this.options.cache.videoCount=0},bindEvent:function(){var c=this,b=this.options,e=a(b.box),k=a(b.mask),l=a(b.urlInput),h=b.cache;a(f).on("click",b.addVideoCardBtn,function(f){var d=a.trim(l.val()),i=d.match(/\/id_([\w\=]+)\.html/);if(!d||!(d=c.getSrc(d)))e.hide(),k.hide(),l.val(""),g.showMessage(j.t9);
else{var m=j.t10,d=a(g.generate({type:"videoUrl",src:d,defaultText:m,id:+new Date}));d.data("data",{type:"videoUrl",src:"http://xtv.xcar.com.cn/player.php?vid="+i[1],defaultText:m});a(b.cardBox).append(d);a(b.count).text(++h.videoCount);e.hide();k.hide();l.val("");c.setPosition();d.find("textarea").focus();f.preventDefault()}});a(f).on("click",b.addCard,function(c){+a(b.count).text()>=b.max?g.showMessage(j.t21):(k.show(),e.show(),c.preventDefault())})},getSrc:function(a){return(a=a.match(/\/id_([\w\=]+)\.html/))?
"http://xtv.xcar.com.cn/player.php?vid="+a[1]:!1},setPosition:function(){a("html, body").stop(!0,!0).animate({scrollTop:a(f).height()},100)}};module.exports=function(a){return new h(a)}});
